# Продакшен-оверлей: не пробрасывать порты db/redis наружу, пароль БД из .env.
# Запуск: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
# В .env задать: POSTGRES_PASSWORD=сильный_пароль

services:
  db:
    environment:
      POSTGRES_USER: elenabot
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-elenabot_secret}
      POSTGRES_DB: elenabot
    ports: []

  redis:
    ports: []

  bot:
    environment:
      DATABASE_URL: postgresql+asyncpg://elenabot:${POSTGRES_PASSWORD:-elenabot_secret}@db:5432/elenabot
      DATABASE_URL_SYNC: postgresql://elenabot:${POSTGRES_PASSWORD:-elenabot_secret}@db:5432/elenabot
      REDIS_URL: redis://redis:6379/0
      RUN_MIGRATIONS: "1"

  worker:
    environment:
      DATABASE_URL_SYNC: postgresql://elenabot:${POSTGRES_PASSWORD:-elenabot_secret}@db:5432/elenabot
      REDIS_URL: redis://redis:6379/0
      CELERY_BROKER_URL: redis://redis:6379/0

  beat:
    environment:
      DATABASE_URL_SYNC: postgresql://elenabot:${POSTGRES_PASSWORD:-elenabot_secret}@db:5432/elenabot
      REDIS_URL: redis://redis:6379/0
      CELERY_BROKER_URL: redis://redis:6379/0
